.Net Core MVC Project --- Migerate to --- .Net Web API 

Recommended Stack for WEB API

1. Backend: .Net Web API Latest
2. Exception handling: Global Middleware
3. Database: Entity Framework Core (SQL Server)
3. Authentication: JWT + ASP.NET Identity (Register and manage users, handle login / logout, manage passwords securely, supports roles and claims, integrate with external login providers)
4. Frontend: Angular / React
5. API Docs: Swagger
6. DTO Mapping: AutoMapper
7. Validation: FluentValidation or Fluent API (clean and more maintainable than writing long if statements)


Migration Steps:

1. Assessment and Planning
-- Analyze Dependencies: Use the .NET Portability Analyzer tool to evaluate the compatibility of your current assemblies and third-party NuGet packages with the target .NET version.
-- Understand Scope: Identify which parts of the existing logic (models, services, controllers) will become API endpoints and which view-related components can be removed. Web APIs focus solely on returning data (JSON/XML), not HTML views.

2. Create the New Web API Project
-- In Visual Studio, create a new ASP.NET Core Web API project.
-- Ensure the target framework is correct (e.g., .NET 8.0, .NET 9.0).
-- Remove default template files like WeatherForecast.cs and Controllers/WeatherForecastController.cs. 

3. Update Project Configuration
-- Replace web.config: ASP.NET Core uses appsettings.json for configuration. Migrate connection strings and other settings to this new file.
Configure Startup.cs or Program.cs:
    -- In the Program.cs file (or Startup.cs for older .NET Core versions), ensure services for controllers are configured: builder.Services.AddControllers(). The AddControllersWithViews() method is for MVC projects and includes view-related services that are unnecessary for a pure API.
    -- Ensure routing is set up in the middleware pipeline with app.UseRouting() and app.MapControllers(). 

4. Migrate and Refactor Controllers
-- Copy Controllers: Move relevant controller files from the MVC project to the new API project's Controllers folder.
-- Change Base Class: Update controllers to inherit from ControllerBase instead of Controller. You may need to add using Microsoft.AspNetCore.Mvc;.
-- Add API Attributes:
    -- Decorate the controller class with [ApiController] and [Route("api/[controller]")] attributes. The [ApiController] attribute enables API-specific conventions, such as automatic model validation errors and attribute routing requirements.
    -- Apply HTTP verb attributes ([HttpGet], [HttpPost], [HttpPut], [HttpDelete]) to action methods to explicitly define their function and routing. 


5. Migrate Models and Business Logic
-- Copy Models: Transfer model classes, data context (if using Entity Framework Core), and other business logic classes to the new project.
-- Update Namespaces: Ensure namespaces in the copied files match the new project's structure.
-- Configure Dependency Injection: ASP.NET Core has built-in dependency injection (DI). Update service configurations in Program.cs (or Startup.cs) to register services, repositories, and DbContexts.
-- Migrate Data Access: If using Entity Framework, ensure you've migrated to Entity Framework Core and run migration commands if needed. 


6. Remove View-Related Components 
-- Since a Web API doesn't render HTML, remove the following items:
    -- The Views folder and all .cshtml files.
    -- References to view engines or HTML-specific results in controllers (e.g., replace return View() with return Ok(object) or other appropriate ActionResult types).
    -- Middleware or services related to serving static files or views if they are no longer necessary (e.g., app.UseStaticFiles() might be removed if the API only serves data). 


7. Testing and Deployment
-- Test Endpoints: Use tools like Swagger (OpenAPI support can be enabled during project creation) or Postman to test all API endpoints thoroughly.
-- Address Errors: Fix any compilation errors, primarily caused by namespace changes or the removal of view-specific functionalities.
-- Deploy: Once tested, deploy the application to your chosen hosting environment. 






Example with sample code:

Migrating .NET Core MVC to Web API – Step by Step

Step 1:
-- you have a .NET Core MVC app:
   -- Controllers return views (IActionResult)
   -- Razor Views handle the Frontend
-- You want a Web API:
   -- Controllers returns JSON
   -- No Views, backend only
   -- Can be consumed by Angular, Reach or Mobile apps


Step 2: Create New Web API Project

dotnet new webapi -n projectname
cd projectname


Step 3: Remove MVC Views
-- Delete the views folder
-- Remove _ViewImports.cshtml and _ViewStart.cshtml
-- Remove UseEndpoints(endpoints => endpoints.MapControllerRoute(.....)) in Startup.cs / Program.cs
-- Keep the Controllers folder


Step 4: Modify Startup / Program
Old MVC style in Program.cs or Startup.cs:

Example:

Before -
builder.Services.AddControllersWithViews();
...
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(
        name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}");
});

After - Web API style
builder.Services.AddControllers(); // only controllers, no views

app.MapControllers(); // map API endpoints


Step 5: Modify Controllers
MVC Controller (Example)

public class ProductsController : Controller
{
    public IActionResult Index()
    {
        var products = _dbContext.Products.ToList();
        return View(products);
    }

    public IActionResult Details(int id)
    {
        var product = _dbContext.Products.Find(id);
        return View(product);
    }
}

Convert to Web API Controller

[Route("api/[controller]")]
[ApiController]
public class ProductsController : ControllerBase
{
    private readonly AppDbContext _dbContext;
    public ProductsController(AppDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    // GET: api/products
    [HttpGet]
    public IActionResult GetProducts()
    {
        var products = _dbContext.Products.ToList();
        return Ok(products);
    }

    // GET: api/products/5
    [HttpGet("{id}")]
    public IActionResult GetProduct(int id)
    {
        var product = _dbContext.Products.Find(id);
        if (product == null)
            return NotFound();
        return Ok(product);
    }

    // POST: api/products
    [HttpPost]
    public IActionResult AddProduct(Product product)
    {
        _dbContext.Products.Add(product);
        _dbContext.SaveChanges();
        return CreatedAtAction(nameof(GetProduct), new { id = product.Id }, product);
    }
}

Key Changes:
-- Controller --> ControllerBase
-- [ApiController] attribute added
-- [Route("api/[controller]")] for RESTfull endpoints
-- return View() --> return ok() / return NotFound() / return CreatedAtAction()



Step 6: Remove View Dependencies
-- Delete all Razor files
-- Remove Microsoft.AspNetCore.Mvc.Razor references if added
-- Keep services, models, DbContext, etc


Step 7: Configure JSON Serialization (Optional)
By default, Web API uses System.Text.Json, but you can use Newtonsoft.Json:

builder.Services.AddControllers()
    .AddNewtonsoftJson(options =>
        options.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore
    );


Step 8: Sample Project Structure

MyWebApiProject/
│
├─ Controllers/
│   └─ ProductsController.cs
│
├─ Models/
│   └─ Product.cs
│
├─ Data/
│   └─ AppDbContext.cs
│
├─ Program.cs
├─ appsettings.json
└─ MyWebApiProject.csproj


Step 9: Test the API
Run the project:

dotnet run

-- Visit https://localhost:5001/api/products → returns JSON
-- Use Postman or Swagger (enabled by default in new Web API template)

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

app.UseSwagger();
app.UseSwaggerUI();


-- Navigate to https://localhost:5001/swagger to test endpoints


Step 10: Optional - Keep MVC + API together
Sometimes you want both MVC Views and Web API in the same project:

builder.Services.AddControllersWithViews();
builder.Services.AddControllers(); // optional

-- Keep your Views folder for MVC pages
-- Add [ApiController] for API controllers
-- Use separate routes: api/products for API, /Home/Index for MVC


